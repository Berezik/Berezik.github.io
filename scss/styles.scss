// ======================================================
// 3D Flipbook — SCSS (Sass) - Фінальна адаптивна версія
// ======================================================

// --- 1. Гнучкі одиниці на основі розміру екрану ---
// 'vmin' - це 1% від меншої сторони екрану (ширини або висоти).
// Це дозволяє книзі ідеально масштабуватися на будь-якому пристрої.
$book-width: 100vmin;
$book-height: 60vmin;
$page-radius: 2vmin;
$page-thickness: 3vmin;
$shadow: 0 2vmin 6vmin rgba(0, 0, 0, 0.25);
$edge: 0 0 0.1vmin rgba(0, 0, 0, 0.25) inset, 0 0 1.8vmin rgba(0, 0, 0, 0.08) inset;

// Інші змінні
$cover-color: #7a5230;
$paper: #fffefa;
$ink: #1c1c1c;

// SVG-рамка (ваш код)
$frame-svg: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64"><defs><radialGradient id="g" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="%23ff79c6"/><stop offset="100%" stop-color="%23ffb6e6"/></radialGradient></defs><g opacity="0.9"><circle cx="8" cy="8" r="5" fill="url(%23g)"/><circle cx="56" cy="8" r="5" fill="url(%23g)"/><circle cx="8" cy="56" r="5" fill="url(%23g)"/><circle cx="56" cy="56" r="5" fill="url(%23g)"/><path d="M8 8 C 24 18, 40 18, 56 8 M8 56 C 24 46, 40 46, 56 56 M8 8 C 8 24, 8 40, 8 56 M56 8 C 56 24, 56 40, 56 56" stroke="%23b983ff" stroke-width="2" fill="none" stroke-linecap="round"/></g></svg>');

:root {
  --speed: 1s;
  --zoom: 1.2;
}

* {
  box-sizing: border-box;
}
.loader {
  font-size: 1.2rem;
  color: #888;
  font-style: italic;
}
.scene {
  perspective: 200vmin; // Адаптивна перспектива
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100vh;
}

.book {
  position: relative;
  width: calc(#{$book-width} / 2); // Початкова ширина = 1 сторінка
  height: $book-height;
  transform-style: preserve-3d;
  transform: rotateX(6deg) rotateY(-18deg);
  transition: all var(--speed) ease-in-out; // Анімуємо всі властивості (включаючи ширину)
  cursor: pointer;
  box-shadow: $shadow;

  &:hover {
    // Ефект при наведенні на закриту книгу
    transform: scale(1.02) rotateX(6deg) rotateY(-18deg);
    box-shadow: 0 2.4vmin 7vmin rgba(0, 0, 0, 0.3);
  }

  &.open {
    width: $book-width; // Розширюємо до повної ширини при відкритті
    transform: scale(var(--zoom)) rotateX(0deg) rotateY(0deg);
    
    // Скасовуємо hover-ефект для відкритої книги
    &:hover {
      transform: scale(var(--zoom)) rotateX(0) rotateY(0);
      box-shadow: $shadow;
    }
  }
}

.page {
  position: absolute;
  top: 0;
  left: 50%; // Всі сторінки починаються з правої половини
  width: calc(#{$book-width} / 2);
  height: $book-height;
  transform-style: preserve-3d;
  will-change: transform;
  background: $paper;
  box-shadow: $edge;
  overflow: hidden;
  transition: transform var(--speed) ease-in-out;
  backface-visibility: hidden; // Виправляє "прозорі" сторінки
  transform-origin: left center; // Всі сторінки гортаються навколо лівого краю
  border-radius: 0 $page-radius $page-radius 0;

  // Ілюзія товщини сторінок
  &:before,
  &:after {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    width: $page-thickness;
    pointer-events: none;
  }
  &:before { // Тінь біля згину
    left: -$page-thickness;
    background: linear-gradient(90deg, rgba(0, 0, 0, 0.18), rgba(0, 0, 0, 0));
  }
  &:after { // Тінь на зовнішньому краю
    right: -$page-thickness;
    background: linear-gradient(270deg, rgba(0, 0, 0, 0.10), rgba(0, 0, 0, 0));
  }

  &.cover {
    background: linear-gradient(145deg, lighten($cover-color, 5%), darken($cover-color, 8%));
    color: #fff;
    box-shadow: 0 3vmin 6vmin rgba(122, 82, 48, 0.45);
    .frame {
      border: none;
      padding: 2rem;
    }
  }

  &.flipped {
    transform: rotateY(-180deg);
  }
  
  // Адаптивні відступи та шрифти всередині сторінки
  .frame {
    position: absolute;
    inset: 1.6vmin;
    padding: 1.8vmin;
    border: 1.8vmin solid transparent;
    border-image: $frame-svg 30 round;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(1px);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    gap: 0.6rem;

    header h2 {
      // clamp(MIN, PREFERRED, MAX) створює "гумовий" шрифт
      font-size: clamp(1rem, 2.2vmin, 1.4rem);
      margin: 0;
      color: $ink;
      text-align: left;
      font-weight: 700;
    }

    .media {
      position: relative;
      width: 100%;
      aspect-ratio: 4/3;
      border-radius: 1.2vmin;
      overflow: hidden;
      box-shadow: 0 1vmin 2.4vmin rgba(0, 0, 0, 0.12);
      
      img,
      video {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
        background-color: #f0ebe5;
      }
    }

    p {
      font-size: clamp(0.8rem, 1.6vmin, 1rem);
      line-height: 1.5;
      margin: 0;
      color: #333;
      overflow: auto;
    }
  }
}

.cover-title {
  font-size: clamp(1.8rem, 4vmin, 2.6rem);
  line-height: 1.1;
  letter-spacing: 0.5px;
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.2);
}

// Адаптивний промінчик
.beam-path {
  position: absolute;
  inset: 1.6vmin;
  z-index: 10;
  pointer-events: none;
  // 'offset-path' тепер встановлюється через JavaScript для адаптивності
}

.beam {
  position: absolute;
  width: 1.2vmin;
  height: 1.2vmin;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255, 215, 0, 1) 0%, rgba(255, 215, 0, 0.7) 60%, rgba(255, 215, 0, 0) 70%);
  box-shadow: 0 0 1vmin rgba(255, 215, 0, 0.9), 0 0 2.4vmin rgba(255, 215, 0, 0.7), 0 0 4vmin rgba(255, 215, 0, 0.4);
  pointer-events: none;
  transform: translate(-50%, -50%);
  opacity: 0; // За замовчуванням невидимий
}

.beam.is-active {
  animation: page-turn-sparkle 1.2s ease-in-out forwards;
}

@keyframes page-turn-sparkle {
  0% {
    opacity: 1;
    offset-distance: 0%;
    transform: translate(-50%, -50%) scale(1);
  }
  50% {
    transform: translate(-50%, -90%) scale(1.4);
  }
  99% {
    opacity: 1;
    offset-distance: 100%;
    transform: translate(-50%, -50%) scale(1);
  }
  100% {
    opacity: 0;
    offset-distance: 100%;
  }
}

// Інші стилі
:focus-visible {
  outline: 2px dashed #8a2be2;
  outline-offset: 2px;
}